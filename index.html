<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Metis: Knowledge Compounding Engine</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <link rel="stylesheet" href="style.css">

    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>
    
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <h1>Project Metis</h1>
            <nav>
                <button class="nav-btn active" data-view="dashboard">대시보드</button>
                <button class="nav-btn" data-view="library">나의 서재</button>
                <button class="nav-btn" data-view="garden">지식 정원</button>
                <button class="nav-btn" data-view="journey">지적 여정 맵</button>
            </nav>
        </aside>

        <main class="main-content">
            <div id="dashboard" class="view active">
                <header class="view-header">
                    <h2>오늘의 지식 탐험</h2>
                    <p>메인북을 중심으로 새로운 지식을 탐험하고, 당신의 자산으로 만드세요.</p>
                </header>

                <div class="dashboard-grid">
                    <div class="dashboard-main">
                        <div id="main-book-slot" class="main-book-slot card">
                            <div class="book-info">
                                <img id="main-book-cover" src="https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1593003033l/54495910.jpg" alt="Book cover" class="book-cover">
                                <div class="book-details">
                                    <h4 id="main-book-title">넛지 (Nudge)</h4>
                                    <p id="main-book-author">리처드 H. 탈러, 캐스 R. 선스타인</p>
                                    <div id="main-book-goal" class="goal">
                                        <strong>현재 목표 (레벨 2)</strong>
                                        <p>선택 설계의 3요소(디폴트, 피드백, 오류 예상)를 설명하고, 실생활 사례 1가지씩 찾아보기.</p>
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                               <button id="change-book-btn" class="btn" style="flex-grow: 1;">책 변경하기</button>
                               <button id="start-goal-navigator-btn" class="btn" style="flex-grow: 1;">목표 재설정</button>
                            </div>
                            <button id="start-session-btn" class="btn btn-primary" style="width: 100%; padding: 16px; font-size: 18px;">메티스 세션 시작하기</button>
                        </div>
                        <div id="refinement-section" class="card">
                            <h3>지식 정제소</h3>
                            <div id="refinement-list">
                                <p class="empty-message">정제 중인 지식이 없습니다.</p>
                            </div>
                        </div>
                    </div>
                    <div class="dashboard-sidebar">
                        <div class="course-selection card">
                            <h5>학습 코스 선택</h5>
                            <div class="course-buttons">
                                <button class="course-btn btn" data-duration="15">15분</button>
                                <button class="course-btn btn active" data-duration="30">30분</button>
                                <button class="course-btn btn" data-duration="45">45분</button>
                                <button class="course-btn btn" data-duration="60">60분</button>
                                <button class="course-btn btn" data-duration="90">90분</button>
                                <button class="course-btn btn" data-duration="120">120분</button>
                            </div>
                        </div>
                         <div class="sub-book-shelf-container card">
                            <h3>관심 서재</h3>
                            <div class="sub-book-shelf">
                               <img src="https://image.aladin.co.kr/product/30883/29/cover500/k252830635_1.jpg" alt="Sub book cover" class="sub-book-cover">
                               <img src="https://image.aladin.co.kr/product/10/3/cover500/8932917248_2.jpg" alt="Sub book cover" class="sub-book-cover">
                               <img src="https://image.aladin.co.kr/product/33359/29/cover500/k252938250_1.jpg" alt="Sub book cover" class="sub-book-cover">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="library" class="view">
                <header class="view-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2>나의 서재</h2>
                        <p>나의 지적 성장을 한눈에 보여주는 개인 맞춤형 대시보드입니다.</p>
                    </div>
                    <button id="add-new-book-to-library-btn" class="btn btn-primary">서재에 새 책 추가하기</button>
                </header>
                <div id="library-stats" class="card">
                    </div>
                <div id="library-shelves">
                    </div>
            </div>
            
            <div id="garden" class="view">
                 <header class="view-header">
                    <h2>지식 정원</h2>
                    <p>당신의 모든 지식 자산(식물)이 자라고 있습니다. 상태를 보고 관리해주세요.</p>
                </header>
                <div class="garden-container" id="garden-container">
                    </div>
            </div>
            
            <div id="journey" class="view">
                <header class="view-header">
                    <h2>지적 여정 맵</h2>
                    <p>당신의 지식들이 어떻게 연결되어 있는지 탐험하세요.</p>
                </header>
                <div id="journey-map-container">
                    <svg id="journey-map-svg"></svg>
                    <p class="empty-message">아직 탐험한 지식이 없습니다. 여정을 시작해보세요!</p>
                </div>
            </div>

            <div id="metis-session-view" class="view">
                 <header class="view-header" style="display: flex; justify-content: space-between; align-items: center;">
                     <button id="back-to-dashboard-btn" class="btn">뒤로가기</button>
                     <h2 style="margin:0;">메티스 학습 세션</h2>
                     <p id="step-title" style="margin:0; min-width: 150px; text-align: right;"></p>
                 </header>
                 <div class="session-content">
                    <div id="session-goal-display" class="goal-display"></div>
                    <div id="step-1" class="step card">
                        <div class="step-header">
                            <h4>[1/8] 학습 예측</h4>
                            <div class="step-timer" id="timer-step-1">03:00</div>
                        </div>
                        <p>제한 시간 안에, 위 목표와 관련하여 책에서 어떤 내용을 다룰 것 같습니까? 핵심 내용을 예측해보세요.</p>
                        <textarea id="prediction-input" placeholder="예: 넛지의 개념을 설명하고..."></textarea>
                        <div id="prediction-options">
                            <p style="margin-bottom: 8px; font-weight: 500;">더 깊은 학습을 위해 예측 시간을 늘려보시겠어요?</p>
                            <button class="btn" id="deepen-prediction-btn" data-time="420">심화 예측 (7분)</button>
                        </div>
                        <button class="btn btn-primary next-step-btn" style="width: 100%;">예측 완료, 집중 독서 시작</button>
                    </div>
                    <div id="step-2" class="step card">
                         <h4>[2/8] 집중 독서</h4>
                         <p>목표에만 집중하여 책을 읽습니다. 중요한 문장을 발견하면 '클리핑' 하세요.</p>
                         <div id="timer-step-2" class="timer-display">00:00</div>
                         <button id="add-clipping-btn" class="btn" style="width: 100%; margin-bottom: 8px;">+ 현재 문단 클리핑하기</button>
                         <button class="btn btn-primary next-step-btn" style="width: 100%;">독서 완료</button>
                    </div>
                     <div id="step-2-break" class="step card" style="text-align: center;">
                         <h4>[3/8] 두뇌 휴식</h4>
                         <p>잠시 학습을 멈추고 뇌를 쉬게 해주세요. 가벼운 스트레칭이나 명상이 좋습니다.</p>
                         <div id="timer-step-2-break" class="timer-display">05:00</div>
                         <button class="btn btn-primary next-step-btn">휴식 완료</button>
                    </div>
                    <div id="step-3" class="step card">
                        <div class="step-header">
                            <h4>[4/8] 생각 기록</h4>
                            <div class="step-timer" id="timer-step-3">05:00</div>
                        </div>
                        <p>제한 시간 안에, 방금 읽은 내용과 그에 대한 당신의 생각을 자유롭게 기록하세요.</p>
                        <textarea id="braindump-input" placeholder="정리되지 않아도 괜찮습니다. 떠오르는 모든 것을 기록하세요."></textarea>
                        <button class="btn btn-primary next-step-btn" style="width: 100%;">기록 완료</button>
                    </div>
                    <div id="step-4" class="step card">
                        <div class="step-header">
                            <h4>[5/8] AI 피드백 예측</h4>
                            <div class="step-timer" id="timer-step-4">05:00</div>
                        </div>
                        <p>제한 시간 안에, AI가 당신의 기록에 대해 어떤 피드백을 줄 것 같습니까? 당신이 놓친 부분은 무엇일까요?</p>
                        <textarea id="ai-prediction-input" placeholder="예: 개념 설명은 잘했지만..."></textarea>
                        <button class="btn btn-primary next-step-btn" style="width: 100%;">예측 완료</button>
                    </div>
                    <div id="step-5" class="step card">
                        <h4>[6/8] 비교 분석</h4>
                        <p>자신의 이해도와 실제 이해도 사이의 격차(Gap)를 객관적으로 인지하세요.</p>
                        <div class="comparison-grid">
                            <div class="comparison-col"><h5>내 생각</h5><div id="reveal-my-thoughts" class="comparison-content"></div></div>
                            <div class="comparison-col"><h5>AI 피드백</h5><div id="reveal-ai-feedback" class="comparison-content"></div></div>
                            <div class="comparison-col"><h5>내 예측</h5><div id="reveal-my-prediction" class="comparison-content"></div></div>
                            <div class="comparison-col"><h5>전문가 요약</h5><div id="reveal-expert-summary" class="comparison-content"></div></div>
                        </div>
                        <button class="btn btn-primary next-step-btn" style="width: 100%;">분석 완료</button>
                    </div>
                    <div id="step-6" class="step card">
                        <div class="step-header">
                            <h4>[7/8] 핵심 질문 추출</h4>
                            <div class="step-timer" id="timer-step-6">05:00</div>
                        </div>
                        <p>제한 시간 안에, 당신의 생각과 AI의 분석 사이에서 발견한 '격차(Gap)'를 해소할 핵심 질문 하나를 뽑아보세요.</p>
                        <textarea id="gap-input" placeholder="예: 각 개념들은 어떻게 유기적으로 연결되는가?"></textarea>
                        <button class="btn btn-primary next-step-btn" style="width: 100%;">질문 추출 완료</button>
                    </div>
                    <div id="step-7" class="step card">
                        <div class="step-header">
                             <h4>[8/8] 체화 글쓰기</h4>
                             <div class="step-timer" id="timer-step-7">05:00</div>
                        </div>
                         <p>제한 시간 안에, 방금 추출한 질문에 대한 답을 스스로 설명하는 한 편의 글을 완성하세요.</p>
                         <textarea id="final-writing-input" placeholder="오늘 배운 내용을 다른 사람에게 설명하듯 글을 작성해보세요."></textarea>
                         <button id="finish-session-btn" class="btn btn-primary" style="width: 100%;">세션 완료</button>
                     </div>
                 </div>
            </div>

            <div id="clipping-review-view" class="view">
                 <header class="view-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <button id="back-to-dashboard-from-review" class="btn">뒤로가기</button>
                    <h2 style="margin:0;">지식 리뷰</h2>
                    <p id="clipping-review-header" style="margin:0;"></p>
                </header>
                <div id="clipping-review-content" class="card"></div>
                <div class="modal-controls" style="justify-content: flex-end;">
                    <button id="finish-review-btn" class="btn btn-primary">리뷰 완료</button>
                </div>
            </div>
        </main>
    </div>
    
    <div id="loader" class="loader-overlay">
        <div class="loader"></div>
        <div class="loader-text">AI가 분석 중입니다...</div>
    </div>

    <div id="book-explorer-modal-overlay" class="modal-overlay">
        <div id="book-explorer-modal" class="modal-content"></div>
    </div>
    <div id="goal-navigator-modal-overlay" class="modal-overlay">
        <div id="goal-navigator-modal" class="modal-content"></div>
    </div>
     <div id="challenge-modal-overlay" class="modal-overlay">
        <div id="challenge-modal" class="modal-content"></div>
    </div>
    <div id="dashboard-modal-overlay" class="modal-overlay">
        <div id="dashboard-modal-content" class="modal-content" style="max-width: 800px;"></div>
    </div>
    <div id="clipping-modal-overlay" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header"><h3>지식 조각 클리핑</h3><p>책에서 발견한 핵심 내용을 붙여넣으세요.</p></div>
            <div class="modal-body">
                <textarea id="clipping-input" placeholder="여기에 중요한 문단을 복사-붙여넣기 하세요..."></textarea>
            </div>
            <div class="modal-controls">
                <button id="cancel-clipping-btn" class="btn">취소</button>
                <button id="save-clipping-btn" class="btn btn-primary">저장하기</button>
            </div>
        </div>
    </div>
    <div id="library-book-detail-modal-overlay" class="modal-overlay">
        <div id="library-book-detail-modal" class="modal-content" style="max-width: 800px;">
            </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js" type="module"></script>
    <script src="./js/main.js" type="module"></script>
</body>
</html>